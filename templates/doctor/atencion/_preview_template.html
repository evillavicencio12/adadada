{% load i18n %}

<div class="space-y-4 text-sm">
    {% if atencion_data.paciente_obj %}
        <h5 class="text-lg font-semibold text-gray-700 border-b pb-2">{% translate "Paciente" %}</h5>
        <p><strong>{% translate "Nombre:" %}</strong> {{ atencion_data.paciente_obj.primer_nombre }} {{ atencion_data.paciente_obj.apellido }}</p>
        <p><strong>{% translate "DNI:" %}</strong> {{ atencion_data.paciente_obj.dni }}</p>
        {% if atencion_data.paciente_obj.birth_date %}
        <p><strong>{% translate "F. Nac:" %}</strong>
            {# Intentar formatear si es un objeto date, sino mostrar como string #}
            {% if atencion_data.paciente_obj.birth_date.year %}
                {{ atencion_data.paciente_obj.birth_date|date:"d/m/Y" }}
            {% else %}
                {{ atencion_data.paciente_obj.birth_date }}
            {% endif %}
        </p>
        {% endif %}
    {% elif atencion_data.paciente_nombre %}
        <h5 class="text-lg font-semibold text-gray-700 border-b pb-2">{% translate "Paciente" %}</h5>
        <p><strong>{% translate "Nombre (ingresado):" %}</strong> {{ atencion_data.paciente_nombre }}</p>
        <p class="text-orange-600"><small>{% translate "Paciente no guardado o no encontrado en la base de datos." %}</small></p>
    {% else %}
         <p class="text-gray-500"><em>{% translate "Paciente no seleccionado." %}</em></p>
    {% endif %}

    <h5 class="text-lg font-semibold text-gray-700 border-b pb-2 mt-4">{% translate "Datos de la Atención" %}</h5>
    <div class="grid grid-cols-2 gap-x-4 gap-y-2">
        <p><strong>{% translate "P. Arterial:" %}</strong> {{ atencion_data.presion_arterial|default:"N/A" }}</p>
        <p><strong>{% translate "Pulso:" %}</strong> {{ atencion_data.pulso|default:"N/A" }} ppm</p>
        <p><strong>{% translate "Temperatura:" %}</strong> {{ atencion_data.temperatura|default:"N/A" }} °C</p>
        <p><strong>{% translate "Frec. Resp.:" %}</strong> {{ atencion_data.frecuencia_respiratoria|default:"N/A" }} rpm</p>
        <p><strong>{% translate "Sat. O₂:" %}</strong> {{ atencion_data.saturacion_oxigeno|default:"N/A" }} %</p>
        <p><strong>{% translate "Peso:" %}</strong> {{ atencion_data.peso|default:"N/A" }} kg</p>
        <p><strong>{% translate "Altura:" %}</strong> {{ atencion_data.altura|default:"N/A" }} m</p>
        <p><strong>{% translate "Control:" %}</strong>
            {% if atencion_data.es_control == 'on' or atencion_data.es_control == True or atencion_data.es_control == 'true' %}
                {% translate "Sí" %}
            {% else %}
                {% translate "No" %}
            {% endif %}
        </p>
    </div>

    <h5 class="text-lg font-semibold text-gray-700 border-b pb-2 mt-4">{% translate "Evaluación Clínica" %}</h5>
    <p><strong>{% translate "Motivo Consulta:" %}</strong><br>{{ atencion_data.motivo_consulta|default:"N/A"|linebreaksbr }}</p>
    <p><strong>{% translate "Síntomas:" %}</strong><br>{{ atencion_data.sintomas|default:"N/A"|linebreaksbr }}</p>
    <p><strong>{% translate "Examen Físico:" %}</strong><br>{{ atencion_data.examen_fisico|default:"N/A"|linebreaksbr }}</p>

    {% if atencion_data.diagnostico_objs %}
    <p><strong>{% translate "Diagnósticos:" %}</strong>
        <ul class="list-disc list-inside ml-4">
        {% for diag in atencion_data.diagnostico_objs %}
            <li>{{ diag.codigo }} - {{ diag.descripcion }}</li>
        {% endfor %}
        </ul>
    </p>
    {% elif atencion_data.diagnostico %}
         <p><strong>{% translate "Diagnósticos (IDs):" %}</strong> {{ atencion_data.diagnostico|join:", " }}</p> <!-- Asume que es una lista de IDs -->
    {% endif %}


    <h5 class="text-lg font-semibold text-gray-700 border-b pb-2 mt-4">{% translate "Plan Terapéutico" %}</h5>
    <p><strong>{% translate "Tratamiento General:" %}</strong><br>{{ atencion_data.tratamiento|default:"N/A"|linebreaksbr }}</p>

    {% if detalles_data %}
        <h6 class="font-semibold text-gray-600 mt-3 mb-1">{% translate "Medicamentos Recetados:" %}</h6>
        <ul class="space-y-1 list-disc list-inside ml-4">
            {% for detalle in detalles_data %}
                {% if not detalle.DELETE and detalle.DELETE != 'on' and detalle.DELETE != 'True' and detalle.DELETE != True %}
                <li>
                    {% if detalle.medicamento_obj %}
                        {{ detalle.medicamento_obj.nombre }}
                    {% elif detalle.medicamento_nombre %}
                        {{ detalle.medicamento_nombre }} <span class="text-orange-500">({% translate "nuevo o no reconocido" %})</span>
                    {% else %}
                        <em>{% translate "Medicamento no especificado" %}</em>
                    {% endif %}
                    {% if detalle.cantidad %}({{ detalle.cantidad }}){% endif %}
                    {% if detalle.prescripcion %}: {{ detalle.prescripcion }}{% endif %}
                </li>
                {% endif %}
            {% endfor %}
        </ul>
    {% endif %}

    <p class="mt-3"><strong>{% translate "Exámenes Solicitados:" %}</strong><br>{{ atencion_data.examenes_enviados|default:"N/A"|linebreaksbr }}</p>
    <p><strong>{% translate "Comentario Adicional:" %}</strong><br>{{ atencion_data.comentario_adicional|default:"N/A"|linebreaksbr }}</p>

</div>
